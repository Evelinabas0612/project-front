<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="../css/my.css" rel="stylesheet">

</head>
<body onload = "jsFunctionSelect();">
<h1>RPG admin panel</h1>
<h2>Accounts list</h2>
<div class="table">
    Count per page:

    <select id="selectCheck" onchange = "jsFunctionSelect();">
        <option value = "0" > </option>
        <option value = "3" >3</option>
        <option value = "8" >8</option>
        <option value = "12" >12</option>
        <option value = "20" >20</option>
    </select>



    <table id = "my_table">
        <tr>
            <th>#</th><th>Name</th><th>Title</th><th>Race</th><th>Profession</th><th>Level</th><th>Birthday</th><th>Banned</th>
        </tr>
    </table>
    <div id="page">
        <span>Pages:</span>


    </div>
</div>
        <script>


            function getCount() {
                let val = 0;
                let url = '/rest/players/count';
                $.ajax({
                    url:url,
                    async:false,
                    success:function (count){
                        val=parseInt(count);
                    }
                })

                return val;


            }



            function jsFunctionSelect(){
               let pageNumber = 1;
               let pageSize = document.getElementById('selectCheck').value;

                if(pageSize  == 0){
                    pageSize  = 3;
                }


                getAllPlayers(pageSize , pageNumber);

            }





            function getAllPlayers(pageSize, pageNumber) {

                let result = getCount();
                console.log(result);
                console.log(pageSize);
                let pages = Math.ceil(result / pageSize);
                let url = '/rest/players';
                url = url.concat('?pageSize=').concat(pageSize);
                url = url.concat('&pagesNumber=').concat(pageNumber);

                $("tr:has(td)").remove();

                $.get(url, function(response){
                    $.each(response,  function (i, item){
                        $('<tr>').html("<td>"
                            + item.id +"</td><td>"
                            + item.name + "</td><td>"
                            + item.title + "</td><td>"
                            + item.race + "</td><td>"
                            + item.profession + "</td><td>"
                            + item.level + "</td><td>"
                            + new Date(item.birthday).toLocaleDateString() + "</td><td>"
                            + item.banned + "</td>"
                        ).appendTo("#my_table");

                    });

                });



                console.log(pages);
                    $("button").remove();

                    for (let j = 1; j <= pages; j++) {
                       let size = pageSize;
                        /*    let page = document.getElementById("page");
                             let div_page = document.createElement("button");
                              div_page.setAttribute("id", "j");
                              div_page.setAttribute("class", "pgn-bnt-styled");
                              div_page.setAttribute("onclick", "getAllPlayers("+size+","+ j+")");
                              let number_page = document.createTextNode("" + j);
                              div_page.appendChild(number_page);
                           age.appendChild(div_page); */
                     let button = "<button>" + j + "</button>";
                     let btn = $(button)
                     .attr('id', "btn_"+ j)
                     .attr('onclick',"getAllPlayers("+size+","+ j+")")
                     .addClass('pgn-bnt-styled');
                     $("#page").append(btn);
                     console.log(size + ":" + j);
             }

     }












</script>


</body>
</html>