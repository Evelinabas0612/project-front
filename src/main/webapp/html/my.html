<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="../css/my.css" rel="stylesheet">

</head>
<body onload = "jsFunctionSelect();">
<h1>RPG admin panel</h1>
<h2>Accounts list</h2>
<div class="table">
    Count per page:

    <select id="selectCheck" onchange = "jsFunctionSelect();">
        <option value = "0" > </option>
        <option value = "3" >3</option>
        <option value = "8" >8</option>
        <option value = "12" >12</option>
        <option value = "20" >20</option>
    </select>



    <table id = "my_table">
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Title</th>
            <th>Race</th>
            <th>Profession</th>
            <th>Level</th>
            <th>Birthday</th>
            <th>Banned</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
    </table>
    <div id="page">
       <span>Pages:</span>


    </div>
</div>
        <script>


            function getCount() {
                let val = 0;
                let url = '/rest/players/count';
                $.ajax({
                    url:url,
                    async:false,
                    success:function (count){
                        val=parseInt(count);
                    }
                })

                return val;


            }



            function jsFunctionSelect(){
               let pageNumber = 0;
               let pageSize = document.getElementById('selectCheck').value;

                if(pageSize  == 0){
                    pageSize  = 3;
                }


                getAllPlayers(pageSize , pageNumber);

            }





            function getAllPlayers(size, page) {
                $("tr:has(td)").remove();

                let result = getCount();
                console.log(result);
                console.log(size);
                let pages = Math.ceil(result / size);
                let url = '/rest/players';
                url = url.concat('?pageSize=').concat(size);
                url = url.concat('&pageNumber=').concat(page);
                console.log(url);

                $.get(url, function(response){
                    $.each(response,  function (i, item){
                        $('<tr>').html("<td>"
                            + item.id +"</td><td>"
                            + item.name + "</td><td>"
                            + item.title + "</td><td>"
                            + item.race + "</td><td>"
                            + item.profession + "</td><td>"
                            + item.level + "</td><td>"
                            + new Date(item.birthday).toLocaleDateString() + "</td><td>"
                            + item.banned + "</td><td>"
                            + "<button id='edit" + item.id +"'>"
                            + "<img src='/img/edit.png'>"
                            + "</button>" + "</td><td>"
                            + "<button id='delete" + item.id +"'onclick='deleteId("+item.id+")'>"
                            + "<img src='/img/delete.png'>"
                            + "</button>"+ "</td>"
                        ).appendTo("#my_table");

                    });

                });



                console.log(pages);
                    $("button.pgn-bnt-styled").remove();

                    for (let j = 0; j < pages; j++) {

                            let page = document.getElementById("page");
                             let div_page = document.createElement("button");
                              div_page.setAttribute("id", "btn"+j);
                              div_page.setAttribute("class", "pgn-bnt-styled");
                              div_page.setAttribute("onclick", "getAllPlayers("+size+","+ j+")");
                              let number_page = document.createTextNode("" + (j+1));
                              div_page.appendChild(number_page);
                            page.appendChild(div_page);
            /*         let button = "<button>" + (j + 1) + "</button>";
                     let btn = $(button)
                     .attr('id', "btn_"+ j)
                     .attr('onclick',"getAllPlayers("+size+","+ j+")")
                     .addClass('pgn-bnt-styled');
                     $("#page").append(btn);*/
                     console.log(size + ":" + j);
             }
            let pageNow = "btn" + page;
                    console.log(pageNow);
            $(pageNow).css("color","red");
            if(pageNow){
                deleteId(id);
                document.location.href = "?";
            }
     }

    function  deleteId(id){
        let url = '/rest/players/'+id;
        console.log(url);
        $.ajax({
            url:url,
            type:'DELETE',
            success:function (data){
                location.reload();
            }
        });
    }










</script>


</body>
</html>